<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù„Ù…Ø§Ù†ÛŒ Ù¾Ù„Ø§Ø³</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f11;
            --card-bg: rgba(255, 255, 255, 0.08);
            --active-color: #00f2ff;
            --text-main: #ffffff;
            --text-sub: #a0a0a5;
            --gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
        }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 20%, rgba(0, 242, 255, 0.1) 0%, transparent 20%),
                              radial-gradient(circle at 90% 80%, rgba(0, 114, 255, 0.1) 0%, transparent 20%);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

       
        header {
            padding: 15px;
            background: rgba(15, 15, 17, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            text-align: center;
        }

        .header-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .header-subtitle { font-size: 11px; color: var(--text-sub); display: flex; align-items: center; justify-content: center; gap: 5px; }
        .pulse { width: 8px; height: 8px; background-color: #00ff88; border-radius: 50%; box-shadow: 0 0 10px #00ff88; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    
        .country-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px 10px 5px 10px;
        }

        .c-btn {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-sub);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .c-btn.active {
            background: rgba(0, 242, 255, 0.15);
            border-color: var(--active-color);
            color: var(--active-color);
            transform: scale(1.05);
        }


        .genre-scroll {
            display: flex;
            overflow-x: auto;
            padding: 10px 15px;
            gap: 8px;
            scrollbar-width: none;
        }
        .genre-scroll::-webkit-scrollbar { display: none; }

        .tag-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-main);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;
            transition: 0.2s;
        }
        .tag-btn.active {
            background: var(--text-main);
            color: var(--bg-dark);
            border-color: var(--text-main);
            font-weight: bold;
        }

        #station-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px 120px 15px;
        }

        .station-item {
            background: var(--card-bg);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        .station-item:active { transform: scale(0.98); }
        .station-item.playing {
            border-color: var(--active-color);
            background: rgba(0, 242, 255, 0.05);
        }

        .st-info { display: flex; flex-direction: column; gap: 4px; }
        .st-name { font-weight: 600; font-size: 15px; }
        .st-meta { font-size: 11px; color: var(--text-sub); display: flex; gap: 8px; }
        .bitrate { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }

        .visualizer {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 20px;
            display: none;
        }
        .station-item.playing .visualizer { display: flex; }
        .bar { width: 3px; background: var(--active-color); animation: sound 0.5s infinite alternate; border-radius: 2px; }
        .bar:nth-child(1) { height: 10px; animation-delay: 0.1s; }
        .bar:nth-child(2) { height: 18px; animation-delay: 0.3s; }
        .bar:nth-child(3) { height: 14px; animation-delay: 0.2s; }
        @keyframes sound { 0% { height: 5px; } 100% { height: 20px; } }
        .player-dock {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(30, 30, 35, 0.95);
            backdrop-filter: blur(15px);
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateY(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 200;
        }
        .player-dock.active { transform: translateY(0); }

        .dock-info { max-width: 60%; }
        .dock-title { font-size: 14px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dock-status { font-size: 11px; color: var(--active-color); margin-top: 2px; }

        .play-btn-large {
            width: 50px; height: 50px;
            border-radius: 50%;
            background: var(--gradient);
            border: none;
            color: white;
            font-size: 20px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 114, 255, 0.4);
            cursor: pointer;
        }

        .bg-notice {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            font-size: 11px;
            text-align: center;
            padding: 8px;
            margin: 10px 15px 0 15px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }

        .loader { text-align: center; margin-top: 30px; font-size: 13px; color: var(--text-sub); }
    </style>
</head>
<body>

<header>
    <div class="header-title">Diamond Radio ğŸ’</div>
    <div class="header-subtitle">
        <div class="pulse"></div>
        Ø§ØªØµØ§Ù„ Ø§Ù…Ù† Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø§Ø±ÙˆÙ¾Ø§
    </div>
</header>

<div class="bg-notice">
    <i class="fas fa-shield-alt"></i>
    Ù¾Ø®Ø´ Ù¾Ø§ÛŒØ¯Ø§Ø±: Ø¨Ø§ Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ØŒ ØµØ¯Ø§ Ù‚Ø·Ø¹ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
</div>

<div class="country-tabs">
    <button class="c-btn active" onclick="setCountry('DE', this)">
        <span style="font-size:16px">ğŸ‡©ğŸ‡ª</span> Ø¢Ù„Ù…Ø§Ù†
    </button>
    <button class="c-btn" onclick="setCountry('AT', this)">
        <span style="font-size:16px">ğŸ‡¦ğŸ‡¹</span> Ø§ØªØ±ÛŒØ´
    </button>
    <button class="c-btn" onclick="setCountry('CH', this)">
        <span style="font-size:16px">ğŸ‡¨ğŸ‡­</span> Ø³ÙˆØ¦ÛŒØ³
    </button>
</div>

<div class="genre-scroll">
    <button class="tag-btn active" onclick="setTag('pop', this)">Pop</button>
    <button class="tag-btn" onclick="setTag('news', this)">News</button>
    <button class="tag-btn" onclick="setTag('talk', this)">Talk</button>
    <button class="tag-btn" onclick="setTag('rock', this)">Rock</button>
    <button class="tag-btn" onclick="setTag('classical', this)">Classic</button>
    <button class="tag-btn" onclick="setTag('dance', this)">Dance</button>
</div>

<div id="station-list">
    <div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§...</div>
</div>

<div class="player-dock" id="dock">
    <div class="dock-info">
        <div class="dock-title" id="p-title">Ù†Ø§Ù… Ø§ÛŒØ³ØªÚ¯Ø§Ù‡</div>
        <div class="dock-status" id="p-status">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</div>
    </div>
    <button class="play-btn-large" id="main-btn" onclick="togglePlay()">
        <i class="fas fa-pause"></i>
    </button>
</div>

<audio id="audio" preload="none"></audio>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.enableClosingConfirmation(); 

    let currentCountry = 'DE';
    let currentTag = 'pop';
    let isPlaying = false;
    const audio = document.getElementById('audio');
    const dock = document.getElementById('dock');
    const pTitle = document.getElementById('p-title');
    const pStatus = document.getElementById('p-status');
    const mainBtn = document.getElementById('main-btn');

    audio.onerror = () => {
        pStatus.innerText = "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø®Ø´!";
        pStatus.style.color = "#ff4444";
        mainBtn.innerHTML = '<i class="fas fa-redo"></i>';
        isPlaying = false;
    };

    async function loadStations() {
        const list = document.getElementById('station-list');
        list.innerHTML = '<div class="loader"><i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</div>';

        try {
            const url = `https://de1.api.radio-browser.info/json/stations/search?limit=30&countrycode=${currentCountry}&tag=${currentTag}&hidebroken=true&order=clickcount&reverse=true&ssl=true`;
            
            const req = await fetch(url);
            const data = await req.json();

            list.innerHTML = '';
            
            if(data.length === 0) {
                list.innerHTML = '<div class="loader">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯ :(</div>';
                return;
            }

            data.forEach(st => {
                const item = document.createElement('div');
                item.className = 'station-item';
                item.innerHTML = `
                    <div class="st-info">
                        <div class="st-name">${st.name}</div>
                        <div class="st-meta">
                            <span class="bitrate">${st.bitrate || 128} Kbps</span>
                            <span>${st.tags.split(',')[0]}</span>
                        </div>
                    </div>
                    <div class="visualizer">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                `;
                item.onclick = () => playStation(st, item);
                list.appendChild(item);
            });

        } catch (e) {
            list.innerHTML = '<div class="loader" style="color:red">Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±</div>';
        }
    }


    function playStation(station, el) {
        // Ø­Ø°Ù Ø§Ø³ØªØ§ÛŒÙ„ ÙØ¹Ø§Ù„ Ù‚Ø¨Ù„ÛŒ
        document.querySelectorAll('.station-item').forEach(i => i.classList.remove('playing'));
        el.classList.add('playing');

        dock.classList.add('active');
        pTitle.innerText = station.name;
        pStatus.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§ÙØ±ÛŒÙ†Ú¯...";
        pStatus.style.color = "#00f2ff";
        mainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

        audio.src = station.url_resolved;
        audio.play().then(() => {
            isPlaying = true;
            pStatus.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ ğŸŸ¢";
            mainBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }).catch(e => {
            pStatus.innerText = "Ù¾Ø®Ø´ Ù†Ø´Ø¯ (ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±)";
            mainBtn.innerHTML = '<i class="fas fa-play"></i>';
        });
    }


    function togglePlay() {
        if(audio.src === "") return;
        
        if (isPlaying) {
            audio.pause();
            isPlaying = false;
            pStatus.innerText = "Ù…ØªÙˆÙ‚Ù Ø´Ø¯ â¸";
            mainBtn.innerHTML = '<i class="fas fa-play"></i>';
            document.querySelector('.station-item.playing .visualizer').style.display = 'none';
        } else {
            audio.play();
            isPlaying = true;
            pStatus.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ ğŸŸ¢";
            mainBtn.innerHTML = '<i class="fas fa-pause"></i>';
            const activeItem = document.querySelector('.station-item.playing .visualizer');
            if(activeItem) activeItem.style.display = 'flex';
        }
    }


    window.setCountry = (code, btn) => {
        document.querySelectorAll('.c-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCountry = code;
        loadStations();
    };


    window.setTag = (tag, btn) => {
        document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentTag = tag;
        loadStations();
    };


    loadStations();

</script>
</body>
</html>